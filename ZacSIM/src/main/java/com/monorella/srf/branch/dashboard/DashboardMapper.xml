<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="com.monorella.srf.branch.dashboard.DashboardMapper">
	
	<!-- 이용중 회원 목록 -->
	<select id="selectUseMemberList" parameterType="String" resultType="com.monorella.srf.branch.dto.UsingMemberList">
		SELECT st.seat_cd AS seat_cd
			, mt.member_nm AS member_nm
			, mt.member_sex AS member_sex
			, rt.room_nm AS room_nm 
			, (SElECT stt.seat_in_time FROM branch_seat_time_tb ORDER BY stt.seat_in_time DESC LIMIT 1) AS in_time
		FROM branch_saet_tb st 
		INNER JOIN branch_member_tb mt 
		ON st.seat_cd = mt.seat_cd
		INNER JOIN branch_room_tb rt 
		ON st.room_cd = rt.room_cd 
		INNER JOIN branch_seat_time_tb stt
		ON st.seat_cd = stt.seat_cd
		WHERE st.branch_owner_cd = #{branch_owner_cd}
		AND st.colseat_state = '입실'
		GROUP BY mt.member_nm
		ORDER BY stt.seat_in_time DESC
	</select>
	
	<!-- 월별 가입자수 -->
	<!-- 월별 남자 가입자수 추이 목록 -->
	<select id="selectInsertNumWoman" parameterType="String" resultType="com.monorella.srf.branch.dto.InsertNumList">
		SELECT january, february, march, april, may, june, july, august, september, october, november, december 
		FROM insert_num_list 
		WHERE branch_owner_cd = #{branch_owner_cd}
		AND member_sex = '여자'
	</select>
	
	<!-- 월별 남자 가입자수 추이 목록 -->
	<select id="selectInsertNumMen" parameterType="String" resultType="com.monorella.srf.branch.dto.InsertNumList">
		SELECT january, february, march, april, may, june, july, august, september, october, november, december 
		FROM insert_num_list 
		WHERE branch_owner_cd = #{branch_owner_cd}
		AND member_sex = '남자'
	</select>
	
	
	<!-- 주 이용 목적 -->
	<!-- 토익 -->
	<select id="selectPurposeLanguage" parameterType="String" resultType="int" >
		SELECT COUNT(*)
		FROM branch_member_tb
		WHERE member_use_pur = "외국어"
		AND branch_owner_cd = #{branch_owner_cd}
	</select>
	<!-- 수능 -->
	<select id="selectPurposeCSAT" parameterType="String" resultType="int" >
		SELECT COUNT(*)
		FROM branch_member_tb
		WHERE member_use_pur = "수능"
		AND branch_owner_cd = #{branch_owner_cd}
	</select>
	<!-- 공무원 -->
	<select id="selectPurposePublicOfficial" parameterType="String" resultType="int" >
		SELECT COUNT(*)
		FROM branch_member_tb
		WHERE member_use_pur = "공무원"
		AND branch_owner_cd = #{branch_owner_cd}
	</select>
	<!-- 자격증 -->
	<select id="selectPurposeLicense" parameterType="String" resultType="int" >
		SELECT COUNT(*)
		FROM branch_member_tb
		WHERE member_use_pur = "자격증"
		AND branch_owner_cd = #{branch_owner_cd}
	</select>
	<!-- 기타 -->
	<select id="selectPurposeEtc" parameterType="String" resultType="int" >
		SELECT COUNT(*)
		FROM branch_member_tb
		WHERE member_use_pur = "기타"
		AND branch_owner_cd = #{branch_owner_cd}
	</select>	
	
	
	<!-- 등록경로 -->
	<!-- 전단지 -->
	<select id="selectPamphletCount" parameterType="String" resultType="int">
		SELECT COUNT(*) 
		FROM branch_member_tb 
		WHERE member_regi_path = "전단지"
		AND branch_owner_cd = #{branch_owner_cd}
	</select>
	<!-- 지인소개 -->
	<select id="selectIntroductionCount" parameterType="String" resultType="int">
		SELECT COUNT(*) 
		FROM branch_member_tb 
		WHERE member_regi_path = "지인소개"
		AND branch_owner_cd = #{branch_owner_cd}
	</select>
	<!-- 인터넷 -->
	<select id="selectInternetCount" parameterType="String" resultType="int">
		SELECT COUNT(*) 
		FROM branch_member_tb 
		WHERE member_regi_path = "인터넷"
		AND branch_owner_cd = #{branch_owner_cd}
	</select>
	<!-- 플래카드 -->
	<select id="selectPlacardCount" parameterType="String" resultType="int">
		SELECT COUNT(*) 
		FROM branch_member_tb 
		WHERE member_regi_path = "플래카드"
		AND branch_owner_cd = #{branch_owner_cd}
	</select>
	<!-- 기타 -->
	<select id="selectEtcCount" parameterType="String" resultType="int">
		SELECT COUNT(*) 
		FROM branch_member_tb
		WHERE member_regi_path = "기타"
		AND branch_owner_cd = #{branch_owner_cd}
	</select>
	
	
	<!-- 열람석 -->
	<!-- 미결제 열람석 -->
	<select id="selectUnpaidSeatCount" parameterType="String" resultType="int">
		SELECT COUNT(*) 
		FROM branch_saet_tb 
		WHERE colseat_state = '빈좌석'
		AND branch_owner_cd = #{branch_owner_cd}
	</select>
	<!-- 부재중 열람석 -->
	<select id="selectAbsenceSeatCount" parameterType="String" resultType="int">
		SELECT COUNT(*) 
		FROM branch_saet_tb 
		WHERE colseat_state = '퇴실'
		AND branch_owner_cd = #{branch_owner_cd}
	</select>
	<!-- 사용중 열람석 -->
	<select id="selectUseSeatCount" parameterType="String" resultType="int">
		SELECT COUNT(*) 
		FROM branch_saet_tb 
		WHERE colseat_state = "입실"
		AND branch_owner_cd = #{branch_owner_cd}
	</select>
	
	
	<!-- 연령대 -->
	<!-- 이용중 10대 여자회원 -->
	<select id="selectUseTeensWomanMemberCount" parameterType="String" resultType="int">
		SELECT COUNT(*)
		FROM branch_member_tb 
		WHERE member_seat_state = "Y"
		AND member_age >= 10 
		AND member_age <![CDATA[ < ]]> 20
		AND member_sex="여자"
		AND branch_owner_cd = #{branch_owner_cd}
	</select>
	<!-- 이용중 10대 남자 회원 -->
	<select id="selectUseTeensMenMemberCount" parameterType="String" resultType="int">
		SELECT COUNT(*)
		FROM branch_member_tb 
		WHERE member_seat_state = "Y"
		AND member_age >= 10 
		AND member_age <![CDATA[ < ]]> 20
		AND member_sex="남자"
		AND branch_owner_cd = #{branch_owner_cd}
	</select>
	<!-- 이용중 20대 여자회원 -->
	<select id="selectUseTwentyWomanMemberCount" parameterType="String" resultType="int">
		SELECT COUNT(*)
		FROM branch_member_tb 
		WHERE member_seat_state = "Y"
		AND member_age >= 20 
		AND member_age <![CDATA[ < ]]> 30
		AND member_sex="여자"
		AND branch_owner_cd = #{branch_owner_cd}
	</select>
	<!-- 이용중 20대 남자 회원 -->
	<select id="selectUseTwentyMenMemberCount" parameterType="String" resultType="int">
		SELECT COUNT(*)
		FROM branch_member_tb 
		WHERE member_seat_state = "Y"
		AND member_age >= 20 
		AND member_age <![CDATA[ < ]]> 30
		AND member_sex="남자";
	</select>
	<!-- 이용중 30대 여자회원 -->
	<select id="selectUseThirtyWomanMemberCount" parameterType="String" resultType="int">
		SELECT COUNT(*)
		FROM branch_member_tb 
		WHERE member_seat_state = "Y"
		AND member_age >= 30 
		AND member_age <![CDATA[ < ]]> 40
		AND member_sex="여자"
		AND branch_owner_cd = #{branch_owner_cd}
	</select>
	<!-- 이용중 30대 남자 회원 -->
	<select id="selectUseThirtyMenMemberCount" parameterType="String" resultType="int">
		SELECT COUNT(*)
		FROM branch_member_tb 
		WHERE member_seat_state = "Y"
		AND member_age >= 30
		AND member_age <![CDATA[ < ]]> 40
		AND member_sex="남자"
		AND branch_owner_cd = #{branch_owner_cd}
	</select>
	<!-- 이용중 40대 여자회원 -->
	<select id="selectUseFortyWomanMemberCount" parameterType="String" resultType="int">
		SELECT COUNT(*)
		FROM branch_member_tb 
		WHERE member_seat_state = "Y"
		AND member_age >= 40 
		AND member_age <![CDATA[ < ]]> 50
		AND member_sex="여자"
		AND branch_owner_cd = #{branch_owner_cd}
	</select>
	<!-- 이용중 40대 남자 회원 -->
	<select id="selectUseFortyMenMemberCount" parameterType="String" resultType="int">
		SELECT COUNT(*)
		FROM branch_member_tb 
		WHERE member_seat_state = "Y"
		AND member_age >= 40 
		AND member_age <![CDATA[ < ]]> 50
		AND member_sex="남자"
		AND branch_owner_cd = #{branch_owner_cd}
	</select>
	<!-- 이용중 기타연령 여자회원 -->
	<select id="selectUseEtcWomanMemberCount" parameterType="String" resultType="int">
		SELECT COUNT(*)
		FROM branch_member_tb 
		WHERE member_seat_state = "Y"
		AND (member_age >= 50 OR member_age <![CDATA[ < ]]> 10)
		AND member_sex="여자"
		AND branch_owner_cd = #{branch_owner_cd}
	</select>
	<!-- 이용중 기타연령 남자 회원 -->
	<select id="selectUseEtcMenMemberCount" resultType="int">
		SELECT COUNT(*)
		FROM branch_member_tb 
		WHERE member_seat_state = "Y"
		AND (member_age >= 50 OR member_age <![CDATA[ < ]]> 10)
		AND member_sex="남자"
		AND branch_owner_cd = #{branch_owner_cd}
	</select>
	
	
	<!-- 회원 -->
	<!-- 당월 등록 회원 -->
	<select id="selectMonthInsertMemberCount" parameterType="String" resultType="int">
		SELECT COUNT(member_month) FROM branch_member_tb WHERE member_month = MONTH(CURDATE()) AND branch_owner_cd = #{branch_owner_cd}
	</select>
	<!-- 금일 등록 회원 -->
	<select id="selectTodayInsertMemberCount" parameterType="String" resultType="int">
		SELECT COUNT(*)
		FROM branch_member_tb 
		WHERE member_date = CURRENT_DATE()
		AND branch_owner_cd = #{branch_owner_cd}
	</select>
	<!-- 여자 회원 -->
	<select id="selectWomanCount" parameterType="String" resultType="int">
		SELECT COUNT(*) FROM branch_member_tb WHERE member_sex = "여자" AND branch_owner_cd = #{branch_owner_cd}
	</select>
	<!-- 남자 회원 -->
	<select id="selectMenCount" parameterType="String" resultType="int">
		SELECT COUNT(*) FROM branch_member_tb WHERE member_sex = "남자" AND branch_owner_cd = #{branch_owner_cd}
	</select>
	<!-- 전체 회원 -->
	<select id="selectMemberCount" parameterType="String" resultType="int">
		SELECT COUNT(*) FROM branch_member_tb WHERE branch_owner_cd = #{branch_owner_cd}
	</select>
	
</mapper>